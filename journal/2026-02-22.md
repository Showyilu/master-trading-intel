# 2026-02-22

Initial bootstrap complete.

- Repository initialized for long-term trading intelligence.
- Core plan and memory scaffolding created.
- Next step: load source inventory + first opportunity pipeline.

## Run @ 03:02 UTC

### 做了什么
- 新增数据源清单与字段映射：`sources/inventory.yaml`（CEX/DEX/链上/新闻）。
- 新增标准化机会 schema：`schemas/normalized_opportunity_v1.schema.json`。
- 新增机会评分与风控模板：`playbooks/opportunity-scoring-template.md`。
- 新增扫描脚本：`scripts/scan_opportunities.py`，自动计算
  `net_edge_bps = gross - fees - slippage - latency_risk - transfer_risk`。
- 生成机会看板与短名单：`opportunities/dashboard-latest.md`、`opportunities/shortlist-latest.json`。

### 结果
- 本轮样本共扫描 4 条候选，按风险门槛通过 1 条。
- 已验证：高 gross edge 在费用/滑点/延迟惩罚后可被过滤掉，避免误报。

### 阻塞点
- 当前输入仍是样本数据，尚未接入实时 API（Binance/Bybit/DEX quote）。
- 尚未引入深度簿和分笔成交，滑点估算仍是简化版本。

### 下一步
- 接入 Binance + Bybit 实时报价适配器并转成 normalized schema。
- 加入基础深度数据估算 size-aware slippage。
- 每轮扫描产出“可执行候选 + 失败原因”双列表。

## Run @ 03:05 UTC

### 做了什么
- 交付实时 CEX 数据接入脚本：`scripts/build_live_cex_candidates.py`（Binance + Bybit）。
- 新增标准化报价 schema：`schemas/normalized_quote_v1.schema.json`。
- 升级扫描器参数化：`scripts/scan_opportunities.py` 支持 `--input/--output-*`，可直接吃 live candidates。
- 产出实时文件：
  - `data/normalized_quotes_cex_latest.json`
  - `data/opportunity_candidates.live.json`
  - `opportunities/shortlist-latest.json`
  - `opportunities/dashboard-latest.md`

### 结果
- 本轮实时拉取并标准化 20 条报价（10 个 symbol × 2 个 CEX）。
- 生成 3 条正向 gross edge 候选，但在 `gross - fees - slippage - latency - transfer_risk` 后全部不达标（0/3 qualified）。
- 验证了系统能稳定给出“可执行候选为空 + 原因可解释”的输出，而不是硬凑信号。

### 阻塞点
- 当前仅 top-of-book，无深度簿/成交分布，滑点仍是保守启发式。
- DEX 侧尚未接入，策略覆盖仍偏窄（暂未覆盖 cex-dex / funding / cross-chain live）。

### 下一步
- 接 Binance/Bybit depth 估算 size-aware slippage（按目标下单金额分档）。
- 接入 1 个 DEX quote 源（优先 Jupiter 或 Uniswap）并统一到同一候选格式。
- 输出失败原因聚合（fee-dominated / latency-dominated / transfer-dominated）用于策略路由。

## Run @ 03:11 UTC

### 做了什么
- 新增 DEX 实时接入与 CEX-DEX 候选生成：`scripts/build_live_cex_dex_candidates.py`（Jupiter + Binance/Bybit）。
- 新增候选合并脚本：`scripts/merge_candidate_files.py`，将 CEX-CEX 与 CEX-DEX 候选统一评分。
- 更新源配置与文档：`sources/inventory.yaml`、`README.md`（新增 live CEX+DEX pipeline）。
- 加入关键风控护栏：DEX `reference_deviation_bps` 与 `crossed_quote` 过滤，拦截假价差（包装资产/异常路由）。
- 重新跑全链路，产出：
  - `data/normalized_quotes_dex_latest.json`
  - `data/opportunity_candidates.cex_dex.live.json`
  - `data/opportunity_candidates.combined.live.json`
  - `opportunities/shortlist-latest.json`
  - `opportunities/dashboard-latest.md`

### 结果
- DEX 标准化报价 2 条（SOL/BTC），其中 BTC 因参考价偏离过大被 guard 过滤（拒绝 1 条）。
- 合并后共评分 6 条候选，按净边际公式 `gross - fees - slippage - latency - transfer` 全部不达标（0 qualified）。
- 系统验证通过：可持续产出“无机会但原因可解释”的结果，避免假阳性。

### 阻塞点
- 仍是 top-of-book + quote 级别，未引入深度簿与下单金额分档，滑点模型仍偏启发式。
- DEX 目前仅 Jupiter；未覆盖 Uniswap/EVM DEX 与链上 gas 拥堵联动惩罚。

### 下一步
- 接 Binance/Bybit orderbook depth，做 size-aware slippage 曲线（按 1k/5k/10k USD 档位）。
- 增加失败原因聚合（fee/slippage/latency/transfer 主导）并写入 dashboard。
- 扩展第二个 DEX 源（Uniswap 或 0x）做交叉校验，降低单源偏差风险。

## Run @ 03:49 UTC

### 做了什么
- 按“别人怎么做套利并赚钱”做了专项研究，重点抽取可落地方法（funding carry / cross-exchange funding / CEX-CEX / CEX-DEX）。
- 新增研究沉淀文档：`research/how-others-find-arb-edge.md`。
- 将外部方法论转换为本项目执行要求：
  - 先净边际再谈机会（而非看 gross spread）
  - 强制 size-aware slippage + 执行可达性
  - 预置库存与风控优先于“追高毛利”

### 结果
- 明确了我们下一阶段主线：从“发现价差”切到“发现可执行净正机会”。
- 结论与当前系统表现一致（目前 0 qualified 并非坏事，说明过滤器在挡假机会）。

### 阻塞点
- 尚缺 funding-rate 实时接入和 depth 曲线，导致 carry 类机会无法稳定量化比较。

### 下一步
- 先补 funding-rate 适配器 + depth slippage 曲线，再更新看板成“执行优先”排序。

## Run @ 04:01 UTC

### 做了什么
- 升级扫描器 `scripts/scan_opportunities.py`：新增拒绝原因标签与主导摩擦项识别（fees/slippage/latency/transfer）。
- 新增结构化输出 `opportunities/rejection-summary-latest.json`，汇总每轮拒绝原因计数与 top rejected 明细。
- 更新看板 `opportunities/dashboard-latest.md`，新增 Rejection Breakdown 区块，直接显示“哪类摩擦最伤净边际”。
- 重跑 live CEX + DEX 全链路（Binance/Bybit/Jupiter -> merge -> score）。

### 结果
- 本轮 3 条候选，0 条通过；拒绝原因聚合显示：`fee_dominated=3`、`latency_transfer_dominated=3`、`slippage_dominated=2`。
- 主导摩擦项统计为 `fees=3`，说明当前首要矛盾是手续费结构而非信号发现不足。
- 交付物已可复现：运行扫描后同时产出 shortlist、dashboard、rejection summary 三份结果文件。

### 阻塞点
- 仍缺 size-aware depth 滑点模型，当前 slippage 以启发式参数估算，难以精细评估不同下单规模。
- funding-rate/basis 数据尚未接入，无法并行评估 carry 类机会池。

### 下一步
- 接入 Binance/Bybit orderbook depth，并按 1k/5k/10k USD 档位输出分层 slippage 曲线。
- 把 rejection summary 接入执行路由规则（例如 fee 主导时优先筛低费账户/预置库存路径）。

## Run @ 06:02 UTC

### 做了什么
- 交付 size-aware 深度滑点模型：重构 `scripts/build_live_cex_candidates.py`，新增 Binance/Bybit orderbook depth 拉取与分档滑点计算（1k/5k/10k USD）。
- 新增输出文件 `data/cex_depth_slippage_latest.json`，记录每个 symbol/venue 的 depth 层级与分档买卖滑点。
- CEX-CEX 候选生成改为优先使用 depth 滑点（无 depth 时才回退到 top-of-book 启发式），并把模型信息写入候选 notes。
- 新增 schema：`schemas/cex_depth_slippage_v1.schema.json`；更新 `README.md` 与运行说明。

### 结果
- 本轮实时构建：20 条 normalized quotes、20 个 depth model（10 symbol × 2 venue）、7 条合并候选（CEX+CEX-DEX）。
- 扫描结果 0/7 qualified；拒绝原因聚合：`fee_dominated=7`、`latency_transfer_dominated=7`、`slippage_dominated=6`。
- 验证点：滑点评估已从“点差近似”升级为“按下单金额分档的订单簿 VWAP 模型”，可复现且可追踪。

### 阻塞点
- 资金费率/funding 与 basis 机会池尚未接入，当前仍主要是 spot 跨场景，机会密度偏低。
- 手续费主导仍最突出，若不引入更低费账户层级或预置库存，净边际很难转正。

### 下一步
- 新增 funding-rate + perp/spot basis 适配器，扩展 carry 类候选池并复用当前净边际风控模板。
- 将 rejection summary 映射为路由动作（fee 主导 -> 优先低费路径；latency 主导 -> 优先同链/预置库存路径）。

## Run @ 08:03 UTC

### 做了什么
- 新增 funding/basis 实时适配器：`scripts/build_live_funding_candidates.py`（Binance Perp + Bybit Linear funding）。
- 新增标准化 funding schema：`schemas/normalized_funding_v1.schema.json`，并更新 `sources/inventory.yaml`（加入 perp funding 数据源）。
- 将 funding 候选接入全链路：更新 `scripts/build_for_web.py`、`.github/workflows/pages-dashboard.yml`、`README.md`，合并池新增 `data/opportunity_candidates.funding.live.json`。
- 重跑全流程并产出：`data/normalized_funding_latest.json`、`data/opportunity_candidates.funding.live.json`、`data/opportunity_candidates.combined.live.json`、`opportunities/rejection-summary-latest.json`。

### 结果
- 本轮 funding 标准化 20 条（10 symbol × 2 venue），生成 funding carry 候选 7 条；与 CEX/CEX-DEX 合并后总候选 13 条。
- 扫描后 0/13 qualified；拒绝聚合显示 `fee_dominated=13`、`latency_transfer_dominated=13`、`slippage_dominated=12`，主导摩擦仍是 fees。
- 验证点：carry 机会已进入统一净边际模板（`gross - fees - slippage - latency - transfer`），并可持续自动产出可复现结果。

### 阻塞点
- 当前 funding gross edge 普遍 <2bps，而 round-trip taker fee + slippage 约 27.4bps，净边际天然为负。
- 缺少 perp-spot basis（同场对冲）与 maker/低费账户参数，导致 carry 桶暂时只起“过滤器”作用。

### 下一步
- 接入 perp-spot basis 适配器（Binance/Bybit mark vs spot mid）并建“预置库存 + maker 费率”分支模型。
- 在 scanner 增加 execution profile（taker/maker、VIP 费率、预置库存开关）做情景化净边际对比。

## Run @ 10:05 UTC

### 做了什么
- 新增 perp-spot basis 实时适配器：`scripts/build_live_basis_candidates.py`，接入 Binance/Bybit spot+perp，产出：
  - `data/normalized_basis_latest.json`
  - `data/opportunity_candidates.basis.live.json`
- 升级 scanner 为 execution profile 模式：`scripts/scan_opportunities.py` 支持 `taker_default / maker_inventory / maker_inventory_vip`，并保留可覆写参数。
- 新增执行画像文档：`playbooks/execution-profiles.md`。
- 更新全链路构建与部署：`scripts/build_for_web.py`、`.github/workflows/pages-dashboard.yml`、`README.md`、`sources/inventory.yaml`、schema 清单。
- 重跑全链路：CEX + CEX-DEX + funding + basis 合并评分。

### 结果
- 本轮新增 basis 候选 20 条；合并后总候选 31 条。
- `taker_default`：0/31 qualified；拒绝原因 `fee_dominated=31`、`slippage_dominated=31`、`latency_transfer_dominated=18`。
- `maker_inventory`：0/31 qualified；净边际较 baseline 明显改善（top net 从约 `-20.74bps` 提升到 `-8.70bps`），但仍未过门槛。
- 验证点：同一批候选已可在不同执行画像下可复现重算，且 basis/funding/spot 统一走同一净边际模板。

### 阻塞点
- 主导摩擦仍是 fees；当前 taker 假设下 basis/funding gross edge 远小于 round-trip 成本。
- 尚未纳入真实借币成本、账户费率等级、可用库存/仓位上限，导致“可执行性”仍停留在模板层。

### 下一步
- 引入 borrow rate + inventory limits 数据输入，加入硬约束（无库存/无借币则直接 reject）。
- 给 scanner 增加 venue-level fee table（VIP/maker rebate）并做 profile 自动映射，而不是固定倍率。
- 追加 perp-spot 持仓窗口复盘（按 1h/4h/8h）验证 basis_capture_ratio 是否过于乐观。

## Run @ 12:06 UTC

### 做了什么
- 交付“可执行容量约束”层：新增 `scripts/build_execution_constraints_template.py`，从当前候选池自动生成 `data/execution_constraints.latest.json`（venue/asset 维度的 `max_position_usd`、`available_inventory_usd`、`max_borrow_usd`、`borrow_rate_bps_per_hour`）。
- 升级扫描器 `scripts/scan_opportunities.py`：
  - 净边际公式扩展为 `gross - fees - slippage - latency - transfer - borrow_cost`；
  - 新增硬门槛：`position_limit_exceeded` / `inventory_unavailable` / `borrow_limit_exceeded`；
  - 输出新增 borrow/inventory/capacity 字段，拒绝原因新增 `borrow_dominated`。
- 新增 schema：`schemas/execution_constraints_v1.schema.json`。
- 打通自动化链路：更新 `scripts/build_for_web.py` 与 `.github/workflows/pages-dashboard.yml`，在评分前自动生成并加载 constraints。
- 更新文档：`README.md` 增加 constraints 用法与风控说明。

### 结果
- 本轮生成约束模板：21 条规则（覆盖 binance/bybit/jupiter 的当前资产集合）。
- 重跑扫描：
  - `taker_default`：0/31 qualified；拒绝聚合新增 `borrow_dominated=20`（其余 `fee_dominated=31`、`slippage_dominated=31`、`latency_transfer_dominated=18`）。
  - `maker_inventory`：0/31 qualified；`borrow_dominated=20`，说明 basis 类在多小时持仓下借币成本已成为实质摩擦项。
- 验证点：系统现在不仅过滤“高摩擦低净边际”，还能显式过滤“容量不可执行/借币不可承受”的候选。

### 阻塞点
- 当前 constraints 仍是模板估计值，不是账户真实可用库存/借币额度/借贷利率。
- venue-level 真实费率（VIP/maker rebate）尚未接入，`fee_dominated` 仍长期主导。

### 下一步
- 接入认证数据（账户余额、仓位上限、借币簿与真实 borrow APR）替换模板约束。
- 将 fee table 做成 venue/account 实值映射，替代 execution profile 的固定倍率。
- 按 1h/4h/8h 持仓窗口复盘 basis/funding 的 borrow+funding 联合净边际，校准持仓时长假设。

## Run @ 14:06 UTC

### 做了什么
- 交付费率模板层：新增 `scripts/build_execution_fee_table_template.py`，从当前候选池自动生成 `data/execution_fee_table.latest.json`（venue + instrument 维度 `taker_bps / maker_bps / maker_vip_bps`）。
- 新增 schema：`schemas/execution_fee_table_v1.schema.json`，把费率配置结构化并可校验。
- 升级扫描器 `scripts/scan_opportunities.py`：
  - 新增 `--fee-table` 参数，支持读取 fee table 覆盖候选内嵌费用；
  - execution profile 改为费率模式映射（`taker_default -> taker`、`maker_inventory -> maker`、`maker_inventory_vip -> maker_vip`）；
  - 支持按策略 round-trip 倍数计费（funding/basis 用 2x side multiplier）。
- 打通自动链路：更新 `scripts/build_for_web.py` 与 `.github/workflows/pages-dashboard.yml`，在评分前自动生成并加载 fee table。

### 结果
- 本轮 fee table 生成 5 条规则（binance/bybit spot+perp + jupiter dex），并成功被 scanner 全量应用（31/31 candidates `fee_model_used=true`）。
- 重跑扫描后 `taker_default` 仍 0/31 qualified；拒绝主因仍为 `fee_dominated + slippage_dominated`，但现在费用假设已集中在单一配置源，便于后续接真实 VIP/返佣参数。
- 看板与 summary 已新增 fee table 追踪信息（包含是否启用、覆盖数量）。

### 阻塞点
- 当前 fee table 仍是模板基线，不是账户真实费率（VIP 等级/返佣/活动费率未接入）。
- DEX 实际执行成本尚未接 gas 实时报价（目前在 dex 费率桶里做保守打包估计）。

### 下一步
- 接 authenticated adapter：拉 Binance/Bybit 账户真实 fee tier + maker rebate，自动回填 `execution_fee_table.latest.json`。
- 加入链上 gas 估算输入（Solana/EVM），把 DEX 费率从固定桶改成实时费用模型。

## Run @ 14:10 UTC

### 做了什么
- 执行端到端构建验证：`python3 scripts/build_for_web.py`（live pull -> merge -> constraints template -> fee table template -> scanner -> site）。
- 验证 CI 工作流路径与本地构建路径一致，确保新增 fee table 层不会破坏自动化产物。

### 结果
- 本轮实时候选 30 条，扫描 0/30 qualified；`fee_model_applied=30`，说明 fee table 覆盖仍完整。
- 新增产物稳定输出：`data/execution_fee_table.latest.json`、`opportunities/rejection-summary-latest.json`、`site/`。

### 阻塞点
- 候选池实时数量会随市场波动，当前仍未出现可执行净正机会（这是过滤器正常工作，不是故障）。

### 下一步
- 将 `execution_fee_table.latest.json` 从模板过渡到账户真实费率源，优先打通 Binance/Bybit authenticated endpoint。

## Run @ 16:05 UTC

### 做了什么
- 新增链上执行成本适配器：`scripts/build_network_friction.py`，实时拉取
  - Solana `getRecentPrioritizationFees`
  - Polygon gas station
  - Ethereum gasnow（beaconcha）
  并统一输出 `data/network_friction.latest.json`（含 USD 与 bps 成本估算）。
- 新增 schema：`schemas/network_friction_v1.schema.json`。
- 升级 `scripts/build_live_cex_dex_candidates.py`：支持读取 `--network-friction`，将 Jupiter 费用从固定 `router_fee` 改为 `router_fee_bps + network_fee_bps`，并把费用来源写入 candidate notes。
- 打通自动链路：更新 `scripts/build_for_web.py` 与 `.github/workflows/pages-dashboard.yml`，在 CEX-DEX 构建前自动生成 network friction。
- 更新文档与源清单：`README.md`、`sources/inventory.yaml`（新增 Solana priority fee / Polygon gas / Beacon gas 源）。

### 结果
- 本轮 `network_friction.latest.json` 成功生成；Jupiter 费用模型为：`router=4.0000bps`、`network=0.001669bps`、`total=4.001669bps`（size=5000 USD）。
- 全链路重跑成功：合并候选 34 条，`taker_default` 下 `0/34 qualified`，拒绝主因仍是 `fee_dominated=34`。
- 可验证交付物：新增脚本 + schema + 实时数据产物 + CI/本地流水线集成全部落地。

### 阻塞点
- 真实账户费率（VIP/返佣）仍未接入，费用主导问题尚无法从根因上缓解。
- EVM gas endpoint 单位口径存在供应商差异，后续需用链上实测成交回执做标定。

### 下一步
- 优先实现 authenticated fee adapter（Binance/Bybit）回填 `execution_fee_table.latest.json`。
- 增加 network friction 标定脚本：用历史真实成交 gas/priority-fee 回执反推 `gas_units_per_leg` 与安全缓冲系数。

## Run @ 18:03 UTC

### 做了什么
- 新增 authenticated fee overlay 脚本：`scripts/build_authenticated_fee_table.py`。
  - 支持 Binance 签名接口（spot `sapi/v1/asset/tradeFee`、perp `fapi/v1/commissionRate`）。
  - 支持 Bybit 签名接口（`v5/account/fee-rate`，spot + linear）。
  - 无鉴权信息时 fail-soft：保留模板费率，不中断流水线。
- 集成到自动流程：
  - `scripts/build_for_web.py` 在 fee template 后自动执行 authenticated overlay。
  - `.github/workflows/pages-dashboard.yml` 增加 secrets 注入与 overlay 步骤。
- 更新文档与计划记忆：`README.md`、`PLAN.md`、`MEMORY.md`。

### 结果
- 全链路验证通过：`python3 scripts/build_for_web.py` 成功跑完（31 candidates，0 qualified，过滤器正常工作）。
- fee overlay 本轮输出：`Authenticated rules updated: 0`，原因是缺少 `BINANCE_*` / `BYBIT_*` 环境变量。
- 可验证交付物：新增可运行脚本 + CI/本地流水线接入；有密钥时可直接把模板费率替换为账户实值。

### 阻塞点
- 当前运行环境未提供 Binance/Bybit API key/secret，无法完成“真实费率”回填。
- 约束层（inventory/borrow/capacity）仍是模板值，尚未接入鉴权账户数据。

### 下一步
- 在 CI secrets/运行环境注入 `BINANCE_API_KEY`、`BINANCE_API_SECRET`、`BYBIT_API_KEY`、`BYBIT_API_SECRET`，验证 authenticated fee 覆盖率与 source 标记。
- 新增 authenticated constraints adapter（余额、借币额度、仓位上限）替换 `execution_constraints.latest.json` 模板估计。

## Run @ 20:00 UTC

### 做了什么
- 交付 authenticated constraints overlay：新增 `scripts/build_authenticated_constraints.py`。
  - Binance: 签名拉取 `/api/v3/account`，按资产余额 × 实时报价换算 USD 库存。
  - Bybit: 签名拉取 `/v5/account/wallet-balance`（UNIFIED），同样换算 USD 库存。
  - 覆盖逻辑：`available_inventory_usd = 实盘库存`，`max_position_usd = min(原上限, inventory + max_borrow)`（保守剪裁）。
  - fail-soft：无密钥或接口失败时保留模板约束，不中断流水线。
- 将该脚本接入全链路：
  - `scripts/build_for_web.py`（constraints template 后自动 overlay）
  - `.github/workflows/pages-dashboard.yml`（新增 secrets 注入与 overlay 步骤）
- 更新文档与状态：`README.md`、`PLAN.md`、`MEMORY.md`。

### 结果
- 本地执行 `python3 scripts/build_for_web.py` 通过，流水线产物持续可生成。
- 本轮 `build_authenticated_constraints.py` 输出 `Authenticated rules updated: 0`（当前环境缺少 Binance/Bybit API 凭证），已验证 fail-soft 行为正常。
- 可验证交付物已落库：新脚本 + CI 集成 + 文档同步。

### 阻塞点
- 运行环境尚未注入 Binance/Bybit API key/secret，无法把模板库存替换为真实库存。
- `max_borrow_usd` 与 `borrow_rate_bps_per_hour` 仍是模板值，借币维度尚未鉴权化。

### 下一步
- 注入四个鉴权环境变量并验证规则覆盖数（期望 binance/bybit 规则从模板库存切到实盘库存）。
- 新增 borrow-book / leverage-tier 适配器，继续替换 `max_borrow_usd` 与借币成本参数。
