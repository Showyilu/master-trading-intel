# 2026-02-23

## Run @ 00:04 UTC

### 做了什么
- 交付 **B类可验证产出（机会评分与风控模板增强）**：在约束模型中新增 `max_leverage`，并贯通到以下模块：
  - `schemas/execution_constraints_v1.schema.json`
  - `scripts/build_execution_constraints_template.py`
  - `scripts/build_authenticated_constraints.py`
  - `scripts/scan_opportunities.py`
- 扫描器新增杠杆硬门槛：当 `required leverage > max_leverage` 时，直接标记 `leverage_limit_exceeded` 并拒绝候选。
- 看板与拒绝摘要新增杠杆可见性（`max_leverage` / `leverage_used`），保证每轮扫描可审计。
- 重跑产线：
  - `build_execution_constraints_template.py`
  - `build_authenticated_constraints.py`
  - `scan_opportunities.py`（`taker_default` + `maker_inventory`）

### 结果
- 约束文件已更新：`data/execution_constraints.latest.json`（21 条规则全部带 `max_leverage`）。
- 本轮扫描（30 candidates）结果：
  - `taker_default`: 0 qualified，新增拒绝计数 `leverage_limit_exceeded=13`
  - `maker_inventory`: 0 qualified，新增拒绝计数 `leverage_limit_exceeded=13`
- 验证通过：`python3 -m py_compile` 对改动脚本编译成功，产物稳定输出（shortlist/dashboard/rejection summary）。

### 阻塞点
- Bybit 借币额度/借币利率仍未接入鉴权覆盖，`max_borrow_usd` 与 `borrow_rate_bps_per_hour` 在 Bybit 侧仍主要依赖模板。
- 当前环境缺少 Binance/Bybit 鉴权变量，authenticated overlay 仍走 fail-soft（不报错但不覆盖实值）。

### 下一步
- 优先接 Bybit signed margin endpoints（借币额度 + 利率 + 可用杠杆层级）并回填 constraints。
- 在 scanner 增加“按策略类型定制杠杆口径”（spot-hedge / basis / funding 分别定义 required leverage）以降低误判。
- 完成后再做一次端到端跑数，确认 `leverage_limit_exceeded` 与 borrow 约束联动一致。

---

## Run @ 02:04 UTC

### 做了什么
- 交付 **B类可验证产出（机会评分与风控模板增强）**：落地“按策略类型定制杠杆口径”。
  - `scripts/scan_opportunities.py` 新增 `strategy_leverage_notional_multiplier` 读取与应用。
  - 杠杆计算改为：`required_notional_usd = size_usd * multiplier`，再对比 `max_leverage`。
  - 输出增强：shortlist/summary 增加 `leverage_notional_multiplier` 与 `leverage_notional_usd`，可审计每个拒绝原因。
- `scripts/build_execution_constraints_template.py` 与 `schemas/execution_constraints_v1.schema.json` 增加 `strategy_leverage_notional_multiplier` 字段，模板可持久化策略口径。
- 更新风控文档：`playbooks/opportunity-scoring-template.md`，明确 net edge 含 borrow cost、杠杆硬门槛公式。
- 端到端重跑：constraints 模板 -> authenticated overlay -> scanner（`taker_default` + `maker_inventory`）。

### 结果
- `data/execution_constraints.latest.json` 已含策略杠杆口径：
  - `cex_cex=1.0`、`cex_dex=1.0`、`funding_carry_cex_cex=2.0`、`perp_spot_basis=1.25`。
- 本轮扫描（30 candidates）保持 0 qualified，但杠杆拒绝识别更完整：
  - `taker_default`: `leverage_limit_exceeded=26`
  - `maker_inventory`: `leverage_limit_exceeded=26`
- 验证通过：`python3 -m py_compile` 编译成功；新字段已写入 shortlist/summary/dashboard。

### 阻塞点
- Bybit 借币额度/借币利率/杠杆层级仍缺 signed overlay，当前 Bybit 风控参数仍是模板值。
- 运行环境仍缺 Binance/Bybit 鉴权变量，authenticated overlay fail-soft（不报错但无实值覆盖）。

### 下一步
- 接 Bybit signed margin endpoints，至少补齐 `max_borrow_usd` 与 `borrow_rate_bps_per_hour` 的实值覆盖。
- 在 scanner 增加“策略级 leverage override 回测开关”（便于 stress test 2.0x/2.5x funding 假设）。
- 完成后做一次对比跑数，确认 leverage reject 与 borrow reject 的分布是否更贴近真实账户能力。
