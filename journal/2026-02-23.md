# 2026-02-23

## Run @ 00:04 UTC

### 做了什么
- 交付 **B类可验证产出（机会评分与风控模板增强）**：在约束模型中新增 `max_leverage`，并贯通到以下模块：
  - `schemas/execution_constraints_v1.schema.json`
  - `scripts/build_execution_constraints_template.py`
  - `scripts/build_authenticated_constraints.py`
  - `scripts/scan_opportunities.py`
- 扫描器新增杠杆硬门槛：当 `required leverage > max_leverage` 时，直接标记 `leverage_limit_exceeded` 并拒绝候选。
- 看板与拒绝摘要新增杠杆可见性（`max_leverage` / `leverage_used`），保证每轮扫描可审计。
- 重跑产线：
  - `build_execution_constraints_template.py`
  - `build_authenticated_constraints.py`
  - `scan_opportunities.py`（`taker_default` + `maker_inventory`）

### 结果
- 约束文件已更新：`data/execution_constraints.latest.json`（21 条规则全部带 `max_leverage`）。
- 本轮扫描（30 candidates）结果：
  - `taker_default`: 0 qualified，新增拒绝计数 `leverage_limit_exceeded=13`
  - `maker_inventory`: 0 qualified，新增拒绝计数 `leverage_limit_exceeded=13`
- 验证通过：`python3 -m py_compile` 对改动脚本编译成功，产物稳定输出（shortlist/dashboard/rejection summary）。

### 阻塞点
- Bybit 借币额度/借币利率仍未接入鉴权覆盖，`max_borrow_usd` 与 `borrow_rate_bps_per_hour` 在 Bybit 侧仍主要依赖模板。
- 当前环境缺少 Binance/Bybit 鉴权变量，authenticated overlay 仍走 fail-soft（不报错但不覆盖实值）。

### 下一步
- 优先接 Bybit signed margin endpoints（借币额度 + 利率 + 可用杠杆层级）并回填 constraints。
- 在 scanner 增加“按策略类型定制杠杆口径”（spot-hedge / basis / funding 分别定义 required leverage）以降低误判。
- 完成后再做一次端到端跑数，确认 `leverage_limit_exceeded` 与 borrow 约束联动一致。

---

## Run @ 02:04 UTC

### 做了什么
- 交付 **B类可验证产出（机会评分与风控模板增强）**：落地“按策略类型定制杠杆口径”。
  - `scripts/scan_opportunities.py` 新增 `strategy_leverage_notional_multiplier` 读取与应用。
  - 杠杆计算改为：`required_notional_usd = size_usd * multiplier`，再对比 `max_leverage`。
  - 输出增强：shortlist/summary 增加 `leverage_notional_multiplier` 与 `leverage_notional_usd`，可审计每个拒绝原因。
- `scripts/build_execution_constraints_template.py` 与 `schemas/execution_constraints_v1.schema.json` 增加 `strategy_leverage_notional_multiplier` 字段，模板可持久化策略口径。
- 更新风控文档：`playbooks/opportunity-scoring-template.md`，明确 net edge 含 borrow cost、杠杆硬门槛公式。
- 端到端重跑：constraints 模板 -> authenticated overlay -> scanner（`taker_default` + `maker_inventory`）。

### 结果
- `data/execution_constraints.latest.json` 已含策略杠杆口径：
  - `cex_cex=1.0`、`cex_dex=1.0`、`funding_carry_cex_cex=2.0`、`perp_spot_basis=1.25`。
- 本轮扫描（30 candidates）保持 0 qualified，但杠杆拒绝识别更完整：
  - `taker_default`: `leverage_limit_exceeded=26`
  - `maker_inventory`: `leverage_limit_exceeded=26`
- 验证通过：`python3 -m py_compile` 编译成功；新字段已写入 shortlist/summary/dashboard。

### 阻塞点
- Bybit 借币额度/借币利率/杠杆层级仍缺 signed overlay，当前 Bybit 风控参数仍是模板值。
- 运行环境仍缺 Binance/Bybit 鉴权变量，authenticated overlay fail-soft（不报错但无实值覆盖）。

### 下一步
- 接 Bybit signed margin endpoints，至少补齐 `max_borrow_usd` 与 `borrow_rate_bps_per_hour` 的实值覆盖。
- 在 scanner 增加“策略级 leverage override 回测开关”（便于 stress test 2.0x/2.5x funding 假设）。
- 完成后做一次对比跑数，确认 leverage reject 与 borrow reject 的分布是否更贴近真实账户能力。

---

## Run @ 04:00 UTC

### 做了什么
- 交付 **B/C类可验证产出（风控回测开关 + 扫描场景产物）**：
  - `scripts/scan_opportunities.py` 新增 CLI：`--strategy-leverage-override STRATEGY=MULTIPLIER`（可重复传参）。
  - 新增 override 解析与输入校验（非法参数直接报错退出，避免静默误配）。
  - 运行时可覆盖 `strategy_leverage_notional_multiplier`，并将覆盖值写入：
    - `opportunities/rejection-summary-*.json -> rules.strategy_leverage_overrides`
    - `opportunities/dashboard-*.md -> Rules 区块`
- 更新文档：
  - `README.md` 增加 leverage stress-test 示例命令
  - `playbooks/opportunity-scoring-template.md` 增加杠杆压力测试说明
- 产出并保存 3 组可复现实验结果：
  - baseline: `opportunities/rejection-summary-maker-baseline-latest.json`
  - high stress (2.5/1.5): `opportunities/rejection-summary-leverage-stress-latest.json`
  - low stress (1.5/1.0): `opportunities/rejection-summary-leverage-stress-low-latest.json`

### 结果
- 代码验证通过：`python3 -m py_compile scripts/scan_opportunities.py`。
- 场景对比（`maker_inventory`, 30 candidates）：
  - baseline（2.0/1.25）: `leverage_limit_exceeded=26`
  - high stress（2.5/1.5）: `leverage_limit_exceeded=26`
  - low stress（1.5/1.0）: `leverage_limit_exceeded=21`
- 三组实验 `qualified` 均为 0，主导拒绝仍是 `fee_dominated=30`，说明当前瓶颈依旧在费率结构而非杠杆假设本身。

### 阻塞点
- Bybit 借币额度/借币利率/杠杆层级仍未接入 signed overlay，当前约束对 Bybit 仍以模板值为主。
- 运行环境暂无 Binance/Bybit 鉴权变量，authenticated overlay 仍为 fail-soft。

### 下一步
- 继续优先接 Bybit margin signed endpoints（借币额度 + 利率 + 杠杆层级），让 stress test 建立在实账户参数上。
- 新增自动化对比脚本（baseline vs overrides），输出 rejection deltas 表格，减少人工比对。
- 在 fee table 层推进真实 VIP/做市费率映射，否则 `fee_dominated` 难以被实质压降。
